
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¢ æ•°å­—é‡‡é›†æŒ‘æˆ˜ | Number Challenge</title>
    <link rel="stylesheet" href="/static/css/challenge.css">
    <link rel="stylesheet" href="/static/css/login-alert.css">
</head>
<body>
    <!-- è¿”å›æŒ‰é’® -->
    <a href="/" class="back-btn">è¿”å›</a>
    
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">ğŸ”¢ æ•°å­—é‡‡é›†æŒ‘æˆ˜</h1>
            <p class="page-subtitle">Number Collection Challenge - æµ‹è¯•ä½ çš„æ•°æ®é‡‡é›†æŠ€èƒ½</p>
        </div>
        
        <!-- ç™»å½•æç¤ºåŒºåŸŸ -->
        <div id="loginAlert" class="login-alert" style="display: none;">
            <div class="login-alert-content">
                <span class="login-alert-icon">ğŸ”</span>
                <span class="login-alert-text">è¯·å…ˆç™»å½•æ‰èƒ½å‚ä¸æŒ‘æˆ˜ï¼</span>
                <a href="/admin_I/" class="login-alert-btn">ç«‹å³ç™»å½•</a>
            </div>
        </div>

        <!-- æŒ‘æˆ˜å†…å®¹ -->
        <div class="challenge-content" style="position: relative;">
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
            </div>

            <div class="challenge-header">
                <h2 class="challenge-title">ğŸ¯ ä»»åŠ¡: é‡‡é›†è¿™100é¡µçš„å…¨éƒ¨æ•°å­—ï¼Œè®¡ç®—åŠ å’Œå¹¶æäº¤ç»“æœ</h2>
                <p class="challenge-description">æ¯ä¸ªé¡µé¢åŒ…å«10ä¸ªéšæœºæ•°å­—ï¼Œä½ éœ€è¦é‡‡é›†æ‰€æœ‰100é¡µçš„æ•°å­—è¿›è¡Œæ±‚å’Œè¿ç®—</p>
            </div>

            <div class="number-challenge">
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="stats-info">
                    <div class="stat-item">
                        <span class="stat-number" id="currentPageNum">1</span>
                        <div class="stat-label">å½“å‰é¡µ</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalPages">5</span>
                        <div class="stat-label">æ€»é¡µæ•°</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="collectedPages">0</span>
                        <div class="stat-label">å·²é‡‡é›†é¡µæ•°</div>
                    </div>
                </div>

                <!-- æ•°å­—ç½‘æ ¼ -->
                <div class="numbers-grid" id="numbersGrid">
                    <!-- æ•°å­—å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        <!-- ç›´æ¥å¼•å…¥ WASM æ¨¡å— -->
        <script type="module">
            import init, { encrypt_simple, aes_encrypt, get_timestamp } from '/static/pkg/wasm_anti.js';

            // åˆå§‹åŒ– WASM å¹¶ç»‘å®šåˆ°å…¨å±€
            init().then(() => {
            window.encrypt_simple = encrypt_simple;
            window.aes_encrypt = aes_encrypt;
            window.get_timestamp = get_timestamp;
            window.wasmReady = true;
            console.log('ğŸ” WASM åŠ å¯†æ¨¡å—å·²å°±ç»ª');
            }).catch(err => {
            console.error('âŒ WASM åŠ è½½å¤±è´¥:', err);
            window.wasmReady = false;
            });
            </script>
            <!-- åˆ†é¡µå¯¼èˆª -->
            <div class="pagination-container">
                <div class="pagination-info" id="paginationInfo">
                    ç¬¬ 1 é¡µï¼Œå…± 5 é¡µ | å½“å‰é¡µé¢åŒ…å« 10 ä¸ªæ•°å­—
                </div>
                
                <div class="pagination" id="paginationControls">
                    <button class="page-btn" onclick="changePage('prev')" id="prevBtn" disabled>â† ä¸Šä¸€é¡µ</button>
                    <button class="page-btn active" onclick="changePage(1)">1</button>
                    <button class="page-btn" onclick="changePage(2)">2</button>
                    <button class="page-btn" onclick="changePage(3)">3</button>
                    <button class="page-btn" onclick="changePage(4)">4</button>
                    <button class="page-btn" onclick="changePage(5)">5</button>
                    <button class="page-btn" onclick="changePage('next')" id="nextBtn">ä¸‹ä¸€é¡µ â†’</button>
                </div>
            </div>

        <!-- ç­”æ¡ˆæäº¤åŒºåŸŸ -->
        <div class="answer-section">
            <h3 class="answer-title">ğŸ’¡ æäº¤ä½ çš„è®¡ç®—ç»“æœ</h3>
            <div class="answer-form">
                <div class="input-group">
                    <label for="answerInput" class="input-label">è¯·è¾“å…¥æ‰€æœ‰æ•°å­—çš„æ€»å’Œ:</label>
                    <input type="text" id="answerInput" class="answer-input" placeholder="ä¾‹å¦‚: 45623" maxlength="10">
                </div>
                <button class="submit-btn" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
            </div>
            <div id="resultMessage" class="result-message"></div>
        </div>
    </div>

    <!-- å¼•å…¥å¤–éƒ¨JavaScriptæ–‡ä»¶ -->
    <script src="/static/js/anti_automation.js"></script>
    <script src="/static/js/login-alert.js"></script>
<script src="/static/js/wasm_challenge.js"></script>
    <script src="/static/js/jquery.js"></script>
    

</div>
    <script>

        /**
         * è·å–æŒ‡å®šé¡µé¢æ•°æ®ï¼ˆé›†æˆ WASM åŠ å¯†éªŒè¯ï¼‰
         * @param {number} page - é¡µç 
         * @param {string} type - æŒ‘æˆ˜ç±»å‹ (card.jsonä¸­çš„id)
         * @returns {Object} é¡µé¢æ•°æ®
         */
        async function apiGetPageData(page, type = challengeType) {
            let url = `/sec1/api/wasm_challenge/page/${page}/?challenge_type=${encodeURIComponent(type)}`;
            let headers = { 'Content-Type': 'application/json' };
            
            // å¦‚æœ WASM å·²å‡†å¤‡å¥½ï¼Œæ·»åŠ åŠ å¯†éªŒè¯
            if (window.wasmReady && window.encrypt_simple) {
                try {
                    const timestamp = Math.floor(window.get_timestamp() / 1000).toString();
                    const verifyString = `${type}_page_${page}`;
                    const wasmAuth = window.encrypt_simple(verifyString, timestamp);
                    
                    // æ·»åŠ  WASM éªŒè¯å‚æ•°åˆ° URL
                    url += `&wasm_auth=${encodeURIComponent(wasmAuth)}`;
                    headers['X-WASM-Timestamp'] = timestamp;
                    headers['X-WASM-Page'] = page.toString();
                    
                } catch (error) {
                    console.warn('âš ï¸ WASM åŠ å¯†å¤±è´¥ï¼Œç»§ç»­æ— éªŒè¯è¯·æ±‚:', error);
                }
            }
            try {
                const data = await $.ajax({
                    url: url,
                    method: 'GET',
                    headers: headers,
                    dataType: 'json'
                });
                return data;
            } catch (xhr) {
                const data = xhr.responseJSON || {};
                const errorMessage = data.error || `HTTP ${xhr.status}: ${xhr.statusText}`;
                throw new Error(errorMessage);
            }
        }

    </script>
</body>
</html>


