import time
from PIL import Image
import httpx
import ddddocr
cookies = {
    'sessionid': 'cjomi84jr3x0r0boau4r978b9sk0qjgy',
}
ocr = ddddocr.DdddOcr(show_ad=False)
ocrt = ddddocr.DdddOcr(beta=True,show_ad=False)
requests=httpx.Client(http2=True,cookies=cookies)
def getimge():

    headers = {
        'accept': 'image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8',
        'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
        'cache-control': 'no-cache',
        'pragma': 'no-cache',
        'priority': 'i',
        'referer': 'https://www.spiderdemo.cn/captcha/cap1_challenge/?challenge_type=cap1_challenge',
        'sec-ch-ua': '"Microsoft Edge";v="141", "Not?A_Brand";v="8", "Chromium";v="141"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'image',
        'sec-fetch-mode': 'no-cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0',
    }
    params = {
        't': str(int(time.time()*1000)),
    }

    response = requests.get(
        'https://www.spiderdemo.cn/captcha/api/cap1_challenge/captcha_image/',
        params=params,
        headers=headers,
    )
    with open('captcha_image.png', 'wb') as f:
        f.write(response.content)
    img = Image.open('captcha_image.png')

    # å‡è®¾ä½ è¦åˆ‡å‰²ä¸€ä¸ªçŸ©å½¢åŒºåŸŸ (left, upper, right, lower)
    # åæ ‡æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹
    crop_box = (53, 20, 95, 36)
    cropped_img = img.crop(crop_box)

    # 3ï¸âƒ£ æ”¾å¤§å›¾ç‰‡
    scale_factor = 2  # æ”¾å¤§ 2 å€
    width, height = cropped_img.size
    resized_img = cropped_img.resize((width * scale_factor, height * scale_factor), Image.LANCZOS)

    # 4ï¸âƒ£ ä¿å­˜æ”¾å¤§åçš„å›¾ç‰‡ï¼ˆå¯é€‰ï¼Œè°ƒè¯•ç”¨ï¼‰
    resized_img.save("resized.png")
    with open("resized.png", "rb") as f:
        img_bytes = f.read()
    yzm1 = ocr.classification(img_bytes)

    yzm2 = ocrt.classification(img_bytes)
    # print(yzm1)
    # print(yzm2)
    return yzm2
def onepage():
    headers = {
        'accept': 'application/json, text/javascript, */*; q=0.01',
        'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
        'cache-control': 'no-cache',
        'pragma': 'no-cache',
        'priority': 'u=1, i',
        'referer': 'https://www.spiderdemo.cn/captcha/cap1_challenge/?challenge_type=cap1_challenge',
        'sec-ch-ua': '"Microsoft Edge";v="141", "Not?A_Brand";v="8", "Chromium";v="141"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0',
        'x-requested-with': 'XMLHttpRequest',
        # 'cookie': 'sessionid=cjomi84jr3x0r0boau4r978b9sk0qjgy',
    }

    params = {
        'challenge_type': 'cap1_challenge',
    }

    response = requests.get(
        'https://www.spiderdemo.cn/captcha/api/cap1_challenge/init/',
        params=params,
        headers=headers,
    )
    res = response.json()
    page_data = res['page_data']
    print(response.text)
    return page_data

# def getnum(nums):
#
#     yzm=getimge()
#
#     headers = {
#         'accept': 'application/json, text/javascript, */*; q=0.01',
#         'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
#         'cache-control': 'no-cache',
#         'content-type': 'application/json',
#         'origin': 'https://www.spiderdemo.cn',
#         'pragma': 'no-cache',
#         'priority': 'u=1, i',
#         'referer': 'https://www.spiderdemo.cn/captcha/cap1_challenge/?challenge_type=cap1_challenge',
#         'sec-ch-ua': '"Microsoft Edge";v="141", "Not?A_Brand";v="8", "Chromium";v="141"',
#         'sec-ch-ua-mobile': '?0',
#         'sec-ch-ua-platform': '"Windows"',
#         'sec-fetch-dest': 'empty',
#         'sec-fetch-mode': 'cors',
#         'sec-fetch-site': 'same-origin',
#         'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0',
#         'x-requested-with': 'XMLHttpRequest',
#         # 'cookie': 'sessionid=cjomi84jr3x0r0boau4r978b9sk0qjgy',
#     }
#
#     json_data = {
#         'captcha_input': yzm,
#         'page_num': nums,
#         'challenge_type': 'cap1_challenge',
#     }
#
#     response = requests.post(
#         'https://www.spiderdemo.cn/captcha/api/cap1_challenge/page/',
#         headers=headers,
#         json=json_data,
#     )
#     res=response.json()
#     page_data=res['page_data']
#     print(response.text)
#     return page_data

def getnum(nums, max_retry=10, delay=2):
    """
    æäº¤éªŒè¯ç å’Œé¡µç ï¼Œå¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆæ¯æ¬¡é‡è¯•é‡æ–°è¯†åˆ«éªŒè¯ç ï¼‰
    """
    for attempt in range(1, max_retry + 1):
        try:
            # æ¯æ¬¡é‡è¯•éƒ½é‡æ–°è·å–éªŒè¯ç 
            yzm = getimge()

            headers = {
                'accept': 'application/json, text/javascript, */*; q=0.01',
                'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
                'cache-control': 'no-cache',
                'content-type': 'application/json',
                'origin': 'https://www.spiderdemo.cn',
                'pragma': 'no-cache',
                'priority': 'u=1, i',
                'referer': 'https://www.spiderdemo.cn/captcha/cap1_challenge/?challenge_type=cap1_challenge',
                'sec-ch-ua': '"Microsoft Edge";v="141", "Not?A_Brand";v="8", "Chromium";v="141"',
                'sec-ch-ua-mobile': '?0',
                'sec-ch-ua-platform': '"Windows"',
                'sec-fetch-dest': 'empty',
                'sec-fetch-mode': 'cors',
                'sec-fetch-site': 'same-origin',
                'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0',
                'x-requested-with': 'XMLHttpRequest',
            }

            json_data = {
                'captcha_input': yzm,
                'page_num': nums,
                'challenge_type': 'cap1_challenge',
            }

            response = requests.post(
                'https://www.spiderdemo.cn/captcha/api/cap1_challenge/page/',
                headers=headers,
                json=json_data,
                timeout=10
            )

            response.raise_for_status()
            res = response.json()

            # éªŒè¯è¿”å›ç»“æœæ˜¯å¦æ­£ç¡®
            if 'page_data' not in res:
                raise ValueError(f"å“åº”ä¸­æ—  page_dataï¼š{res}")

            print(f"âœ… ç¬¬ {attempt} æ¬¡æˆåŠŸ")
            return res['page_data']

        except Exception as e:
            print(f"âŒ ç¬¬ {attempt} æ¬¡å¤±è´¥ï¼š{e}")
            if attempt < max_retry:
                print("â³ ç­‰å¾…é‡è¯•ä¸­...\n")
                time.sleep(delay)
            else:
                print("ğŸš¨ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¿”å› None")
                return None
if __name__ == '__main__':
    onedata=onepage()
    allnums = []
    allnums.extend(onedata)
    for i in range(2, 101):
        data = getnum(i)
        allnums.extend(data)
    print(allnums)
    # allnums=['8776', '1088', '3541', '9596', '9641', '4760', '4283', '9879', '2522', '1918', '7821', '8812', '6368', '6076', '8004', '3407', '9053', '1204', '8309', '7187', '5809', '7612', '5935', '8534', '8766', '8202', '1018', '6321', '6924', '5968', '6671', '1242', '5532', '1879', '8498', '9708', '8575', '2233', '6984', '5970', '7298', '1926', '6744', '1061', '1743', '4733', '2206', '3651', '5387', '6095', '3135', '6443', '5139', '8888', '4506', '6941', '3608', '7284', '8953', '5689', '6085', '2583', '2005', '2080', '6523', '9840', '8946', '9114', '6173', '1555', '2569', '3339', '6707', '7368', '3380', '5185', '5213', '5055', '3028', '3499', '5745', '8028', '9787', '7619', '9639', '2719', '3120', '8755', '8613', '5012', '9231', '1739', '1141', '4584', '4316', '2464', '6325', '8389', '4218', '4445', '3897', '9470', '8792', '4009', '5251', '6064', '8024', '2486', '4390', '4049', '9866', '7420', '4011', '5059', '4294', '5231', '2214', '3530', '8995', '5845', '5823', '3140', '4896', '4275', '9214', '2835', '2084', '2263', '9905', '5299', '2559', '9107', '2902', '4000', '5408', '7379', '4682', '7052', '6056', '4467', '3239', '1641', '1746', '1675', '4530', '2121', '7004', '8241', '8854', '7314', '5933', '1794', '5572', '6290', '6410', '4976', '9030', '1742', '2001', '1963', '4068', '9135', '5071', '5959', '3400', '1654', '9946', '6397', '4497', '4259', '2856', '3152', '4378', '9196', '8866', '2458', '3427', '5073', '9460', '4388', '7710', '7127', '9544', '9521', '5831', '6053', '5538', '5392', '2019', '8545', '3940', '7167', '8940', '8040', '1990', '8108', '2821', '8734', '7728', '8084', '6516', '4527', '3345', '7947', '3811', '9079', '3864', '8738', '4769', '3746', '5105', '3773', '6438', '3139', '1567', '4541', '7549', '1469', '4275', '1570', '2012', '5279', '9327', '6896', '5458', '7233', '9980', '5103', '5975', '1770', '8294', '1347', '2506', '1723', '9561', '8924', '8662', '8037', '8404', '1573', '8073', '2640', '3340', '7659', '7861', '1991', '6582', '7549', '4095', '3932', '1038', '8618', '6966', '1966', '6953', '6649', '7059', '9402', '5790', '2299', '1089', '2397', '4075', '5403', '2094', '1399', '9373', '8713', '6557', '4701', '4696', '2383', '1386', '9343', '2266', '7979', '3212', '1758', '3797', '4937', '9819', '9178', '4881', '1645', '7450', '5103', '6005', '5051', '3119', '4175', '3119', '5372', '6930', '7308', '2087', '1355', '5546', '6667', '7059', '2226', '6816', '5646', '6976', '8603', '8440', '7531', '6040', '4385', '4260', '5471', '9558', '4747', '7689', '2498', '9464', '1535', '6010', '5650', '7359', '1326', '2427', '6016', '7008', '8624', '9257', '6683', '6387', '3071', '6635', '9100', '5279', '7706', '8029', '1091', '7786', '7409', '9272', '1606', '9042', '2801', '2467', '1743', '7762', '7397', '9805', '5215', '3244', '4680', '1168', '7878', '3832', '4373', '4676', '9722', '5171', '7193', '7648', '3461', '8671', '8485', '4496', '5425', '1649', '1506', '2828', '8206', '2323', '8613', '8276', '5925', '4131', '7626', '8863', '4484', '2100', '1317', '8386', '4606', '9259', '8280', '9597', '6720', '2332', '6523', '5343', '9754', '1370', '5505', '3447', '9135', '3661', '8137', '4280', '2338', '5720', '8383', '3315', '4119', '3051', '8450', '7252', '5054', '9397', '3820', '9342', '1767', '2203', '1603', '7867', '7597', '1460', '9619', '9441', '2691', '6263', '7523', '4844', '1923', '2724', '9728', '2383', '5169', '1226', '8880', '8226', '4861', '9656', '5648', '4864', '4507', '2921', '3667', '5790', '4744', '5947', '1995', '8752', '8541', '2289', '2208', '2395', '7066', '9014', '9886', '7679', '1435', '3629', '1297', '5067', '3268', '1709', '1749', '2177', '9858', '7660', '5906', '6199', '4337', '3931', '6117', '4255', '7926', '7085', '4191', '3753', '6050', '1588', '1389', '4459', '9401', '7879', '2413', '3786', '2321', '6261', '6026', '6346', '6714', '3157', '5934', '8812', '2476', '1548', '2806', '9061', '6496', '3139', '2095', '6296', '6070', '4144', '2498', '1577', '8318', '3438', '8080', '8311', '2337', '4934', '5404', '9235', '6436', '9879', '9470', '8651', '4442', '4276', '5175', '2877', '9392', '4063', '8757', '3988', '5958', '9577', '2372', '6224', '8309', '9438', '3411', '8619', '8087', '7198', '1478', '7678', '9716', '6285', '9464', '5987', '4009', '4163', '9733', '6349', '6188', '7382', '6432', '5436', '3427', '7907', '2764', '9643', '5587', '7853', '1498', '8858', '1123', '1059', '6807', '9334', '8508', '4656', '3618', '2532', '4107', '2469', '4389', '3906', '2184', '3640', '2872', '5953', '5365', '9110', '1224', '1276', '8448', '2308', '8481', '1257', '2720', '2886', '7158', '6062', '4659', '7850', '4126', '6911', '5260', '2677', '8331', '1581', '5722', '1762', '1946', '8438', '5296', '7315', '6308', '9007', '5228', '2050', '3285', '4280', '8949', '4454', '4435', '6910', '7571', '2261', '4953', '7461', '9316', '3211', '6158', '6793', '3945', '3125', '8360', '4099', '6021', '2469', '5191', '8912', '5041', '4640', '3651', '1771', '6882', '1218', '3877', '1683', '4294', '7319', '2368', '6095', '6825', '2498', '5328', '6312', '1062', '3346', '6475', '6021', '4492', '4309', '5873', '4597', '2867', '2357', '7790', '1171', '4043', '1270', '5480', '6896', '7446', '2570', '8556', '3271', '1614', '8918', '5324', '5229', '6341', '2373', '7366', '2682', '6401', '8998', '8464', '4640', '3376', '4272', '8725', '2412', '3281', '3357', '7832', '3104', '4315', '3005', '4591', '5114', '2920', '8238', '4872', '8537', '7735', '5483', '4919', '9636', '1266', '7621', '7870', '7078', '1984', '2628', '9559', '1252', '1993', '2267', '1012', '7520', '3006', '9877', '2017', '4854', '2723', '3984', '1112', '5376', '9486', '1404', '6338', '9464', '3363', '7182', '5836', '4566', '8972', '4174', '9469', '7182', '5724', '6027', '6267', '7024', '6721', '6569', '1923', '7782', '8100', '3802', '8183', '2221', '5925', '7837', '5757', '8440', '4771', '8714', '2050', '6341', '6590', '7779', '9995', '8904', '9967', '9328', '2494', '5634', '9803', '5056', '9476', '3775', '8287', '1577', '3530', '6910', '6391', '6510', '1033', '6716', '9679', '3913', '3012', '2437', '8779', '4905', '1208', '8058', '3001', '9939', '7902', '1308', '1673', '4283', '9505', '1209', '4154', '3027', '6157', '9981', '1747', '7066', '1446', '2561', '7021', '1952', '5464', '1682', '6966', '9417', '7204', '4681', '7966', '6410', '6302', '3235', '9449', '8747', '4766', '7114', '2301', '9782', '9815', '1106', '9255', '6434', '6675', '3651', '9527', '1724', '5957', '5318', '4090', '3782', '4463', '6740', '1156', '4805', '8907', '6148', '5795', '1855', '3673', '7561', '2762', '9835', '5785', '2761', '3805', '1114', '6443', '9729', '2070', '4659', '4475', '3591', '1846', '5781', '7121', '9229', '2703', '3601', '7856', '9151', '3578', '2040', '8097', '6406', '6169', '4318', '9234', '4968', '1604', '7553', '4597', '2354', '8910', '9643', '8699', '9071', '5328', '6152', '7227', '7665', '5363', '8755', '1596', '6020', '1788', '3719', '7076', '6592', '5329', '3473', '9683', '7031', '2579', '9633', '2475', '1057', '4124', '9064', '6211', '7246', '5426', '8964', '9793', '6205', '8991', '1472', '7179', '3419', '3796', '6614', '1522', '1033', '3733', '3416', '1431', '2034', '3545', '8996', '2116', '6395', '7707', '7857', '1697', '3682', '8419', '1749', '8869', '4626', '1195', '2098', '1511', '2447', '3192', '8618', '2089', '8336', '4429', '3914', '5745', '6954', '3446', '2101', '8272', '9440', '9036', '7884', '2248', '7983', '5595', '3529', '9562', '5417', '4787', '8769', '9899', '4050', '2822', '5990', '3682', '4617', '4065', '4903', '1123', '7748', '7677', '8965', '7899', '3733', '1104', '2288', '5023', '5927', '9173', '2556', '5508', '2978', '1706', '4374', '3135', '9227', '7331', '5358', '7016', '8277', '6915', '7322', '9316', '5526', '6795', '9668', '4303', '4211', '8731', '1030', '1860', '2119', '3949', '1667', '8791', '6589', '2441', '3698', '8030', '4268', '3752', '5570', '2176', '6935', '2160', '5953', '6033', '8998', '6816', '7199', '2030', '8636', '9019', '4734', '1373', '1473', '1639', '1166', '8213']
    nidnum = 0
    for i in allnums:
        newi = int(i)
        nidnum = nidnum + newi
    print(nidnum)

